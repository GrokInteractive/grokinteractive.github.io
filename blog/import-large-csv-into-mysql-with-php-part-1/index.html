<!DOCTYPE html>
<html lang="en">
<head>
  <title>Importing Large CSV files with PHP Part 1: Import using one query</title>

<meta charset="utf-8">
<meta http-equiv="Content-Language" content="en" />
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
<meta name="author" content="Grok Interactive, LLC">
<meta name="description" content="Ever have problems importing large CSV files into your application? Here is a guide to do it with just one query!">
<meta name="MS.LOCALE" content="EN-US" />
<meta name="revisit-after" content="10 days" />
<meta name="robots" content="index,follow" />
<meta name="URL" content="http://www.grok-interactive.com" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta property="fb:admins" content="440639386014676"/>
<meta property="fb:admins" content="621293620"/>
<meta property="fb:admins" content="710704899"/>

<meta property="og:title" content="Importing Large CSV files with PHP Part 1: Import using one query">

<meta property="og:type" content="article">

<meta property="og:url" content="http://www.grok-interactive.com/blog/import-large-csv-into-mysql-with-php-part-1/">


<meta property="og:image" content="http://www.grok-interactive.com/images/2015/08/CSV_into_MySQL.png">



<meta property="og:description" content="Ever have problems importing large CSV files into your application? Here is a guide to do it with just one query!">


<meta property="og:site_name" content="Grok Interactive">

<meta property="og:locale" content="en_US">


<meta property="article:published_time" content="2015-09-22T00:00:00-04:00">


<meta property="fb:admins" content="">
<meta property="fb:app_id" content="">


<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@GrokInteractive" />
<meta name="twitter:title" content="Importing Large CSV files with PHP Part 1: Import using one query" />
<meta name="twitter:description" content="Ever have problems importing large CSV files into your application? Here is a guide to do it with just one query!" />
<meta name="twitter:url" content="http://www.grok-interactive.com/blog/import-large-csv-into-mysql-with-php-part-1/" />


<meta name="twitter:image" content="http://www.grok-interactive.com/images/2015/08/CSV_into_MySQL.png" />




<link rel='stylesheet' href='http://fonts.googleapis.com/css?family=Open+Sans:400,700,800,300|Open+Sans+Condensed:300' type='text/css' />
<link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.3/css/font-awesome.min.css' type='text/css' media='all' />

<link href='/assets/global-6b2036851216c08cdb9f2f1abbb4e9ac.css' rel='stylesheet' type='text/css' />

<link rel="apple-touch-icon-precomposed" sizes="57x57" href="/images/favicons/apple-touch-icon-57x57.png" />
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/favicons/apple-touch-icon-114x114.png" />
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/favicons/apple-touch-icon-72x72.png" />
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/favicons/apple-touch-icon-144x144.png" />
<link rel="apple-touch-icon-precomposed" sizes="60x60" href="/images/favicons/apple-touch-icon-60x60.png" />
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="/images/favicons/apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon-precomposed" sizes="76x76" href="/images/favicons/apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="/images/favicons/apple-touch-icon-152x152.png" />
<link rel="icon" type="image/png" href="/images/favicons/favicon-196x196.png" sizes="196x196" />
<link rel="icon" type="image/png" href="/images/favicons/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/png" href="/images/favicons/favicon-32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="/images/favicons/favicon-16x16.png" sizes="16x16" />
<link rel="icon" type="image/png" href="/images/favicons/favicon-128.png" sizes="128x128" />
<meta name="application-name" content="Grok Interactive, LLC"/>
<meta name="msapplication-TileColor" content="#000000" />
<meta name="msapplication-TileImage" content="/assets/img/favicons/mstile-144x144.png" />
<meta name="msapplication-square70x70logo" content="/assets/img/favicons/mstile-70x70.png" />
<meta name="msapplication-square150x150logo" content="/assets/img/favicons/mstile-150x150.png" />
<meta name="msapplication-wide310x150logo" content="/assets/img/favicons/mstile-310x150.png" />
<meta name="msapplication-square310x310logo" content="/assets/img/favicons/mstile-310x310.png" />


</head>

<body style="display: none;">

  <div id="wrap">
    <div id="main">
      <header>
        <div class="navbar navbar-inverse navbar-static-top">
          <div class="navbar-inner">
            <div class="container">
              <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="brand grok-logo" href="/">Grok Interactive, LLC Home Page</a>
              <div class="nav-collapse collapse pull-right">
                <ul class="nav">
                  <li class='blog active'><a href="/blog/">Blog</a></li>
                  <li class='podcast'><a href="/podcast/">Podcast</a></li>
                  <li class='about'><a href="/#about" class='slide'>About</a></li>
                  <li class='service'><a href="/#service" class='slide'>Service</a></li>
                  <li class='work'><a href="/#work" class='slide'>Work</a></li>
                  <li class='contact'><a href="/#contact" class='slide'>Contact</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </header>
      <section class="podcast-cta" id="podcast-cta" >

        <div class="container">
          <div class="row">
            <div class="span12">

              <h4>Check out our new <a href="/podcast/">podcast</a> "The Grok Cast" now <a href="https://itunes.apple.com/us/podcast/the-grok-cast/id1036008796">available on iTunes!</a></h4>

            </div>
          </div>
        </div>

      </section>
      <div class="content">
  <div class="container">
    <div class="inner">
      <div class="canvas">

        <div class="columns">
          <div class="col c70">

            
            

            <div class="canvas">

              <div class="post" itemscope itemtype="http://schema.org/BlogPosting" itemid="http://www.grok-interactive.com/blog/import-large-csv-into-mysql-with-php-part-1/">

                <h1 itemprop="headline"><a href="/blog/import-large-csv-into-mysql-with-php-part-1/" rel="bookmark" title="Link to Importing Large CSV files with PHP Part 1: Import using one query">Importing Large CSV files with PHP Part 1: Import using one query</a></h1>
                <meta itemprop="name" content="Importing Large CSV files with PHP Part 1: Import using one query">
                <meta itemprop="description" content="Ever have problems importing large CSV files into your application? Here is a guide to do it with just one query!">
                <meta itemprop="datePublished" content="2015-09-22 00:00:00 -0400">
                <meta itemprop="image" content="http://www.grok-interactive.com/images/2015/08/CSV_into_MySQL.png">
                <meta itemprop="discussionUrl" content="http://www.grok-interactive.com/blog/import-large-csv-into-mysql-with-php-part-1/">
                <h5 itemprop="author" itemscope itemtype="http://schema.org/Person">by <a href="http://www.grok-interactive.com/blog/author/anton-domratchev" class="author" itemprop="url"><span itemprop="name">Anton Domratchev</span></a>
                  &nbsp;&nbsp;&nbsp;<strong>Sep 22, 2015</strong>&nbsp;&nbsp;&nbsp;
                  
                  <i class="icon fa fa-folder" title="Categories"></i>
                  
                  <a href="/blog/category/software_development/" class="category">Software development</a>
                  
                  

                  
                  <i class="icon fa fa-tags" title="Tags"></i>
                  
                  <a href="/blog/tag/csv/" class="tag">Csv</a>,
                  
                  <a href="/blog/tag/mysql/" class="tag">Mysql</a>,
                  
                  <a href="/blog/tag/php/" class="tag">Php</a>,
                  
                  <a href="/blog/tag/laravel/" class="tag">Laravel</a>
                  
                  

                  
                </h5>

                <div class=''>

                  
                  <img src="/images/2015/08/CSV_into_MySQL.png" width="150" height="150" class="pull-right" />
                  

                  <p>Importing CSV files into your application can become a problem when the file is really big, &gt; 65,000 rows big. Each row of the file needs to be parsed, converted into an object, and then saved to a database. All of this needs to happen within a 30 second timeout window. It may sound like an impossible task, but there are actually a couple of solutions that can solve this problem. While working on a project at Grok, I was tasked with doing exactly that. </p>

<p>Initially I hoped to save the CSV file to a directory and iterate through it in a single request. I was only able to get through about 1/3 of the file before the request timed out. The second attempt was to upload the file and process it at a later time. I saved the CSV file to a temp directory, used a support class to split the original file, and saved 10,000 row chunks in processing directory. I decided to split the file in order to reduce the margin of error for large files in this case that the import did fail at some point, it would only be a part of the file instead of the entire file. </p>

<p>I also set up an artisan command which will look for files in processing directory and process the 10,000 row chunk without worrying about HTTP request timeout. I hooked the artisan command into a cronjob and ran it every minute on the server. (Stay tuned for my guide on how to process csv files using a command) This solved the problem but it was not very well tested since it relied primarily on file system. If the import of chunk would fail we didn&#39;t have any information to debug why it failed. After about 6 months it came time to add more features to the CSV importer and was a perfect time to refactor this feature.</p>

<p>After hours of research I came up on this MySQL function</p>
<div class="highlight"><pre><code class="language-mysql" data-lang="mysql"><span class="k">LOAD</span> <span class="n">DATA</span> <span class="n">LOCAL</span> <span class="k">INFILE</span> <span class="s1">&#39;path/to/file.csv&#39;</span> <span class="k">INTO</span> <span class="k">TABLE</span> <span class="s1">&#39;table_name&#39;</span><span class="p">;</span>
</code></pre></div>
<p>You can read more on the <code>LOAD DATA</code> function <a href="https://dev.mysql.com/doc/refman/5.1/en/load-data.html">here</a>. This was exciting discovery because the performance of importing a CSV file directly into mySQL database was unparalleled. Using this SQL query I was able to import a 65,000 row file in under 10 seconds, it is BLAZING fast. Below I will explain how to use this query in order to quickly import a CSV file into your Laravel app.</p>

<h3>Controller</h3>

<p>First lets set up our <code>CsvImportController.php</code> in  <code>app/Acme/Controllers/</code></p>

<blockquote>
<p>Note: I am using PSR-4 namespacing check out <a href="http://www.php-fig.org/psr/psr-4/">PSR-4 documentation</a> for details</p>
</blockquote>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Acme\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Acme\Importing\CsvImporter</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Input</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Redirect</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CsvImportController</span> <span class="k">extends</span> <span class="nx">BaseController</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * [POST] Form which will submit the file</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">store</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Check if form submitted a file</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">Input</span><span class="o">::</span><span class="na">hasFile</span><span class="p">(</span><span class="s1">&#39;csv_import&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$csv_file</span> <span class="o">=</span> <span class="nx">Input</span><span class="o">::</span><span class="na">file</span><span class="p">(</span><span class="s1">&#39;csv_import&#39;</span><span class="p">);</span>

            <span class="c1">// You wish to do file validation at this point</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$csv_file</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">())</span> <span class="p">{</span>

                <span class="c1">// We can also create a CsvStructureValidator class</span>
                <span class="c1">// So that we can validate the structure of our CSV file</span>

                <span class="c1">// Lets construct our importer</span>
                <span class="nv">$csv_importer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CsvFileImporter</span><span class="p">();</span>

                <span class="c1">// Import our csv file</span>
                <span class="k">if</span> <span class="p">(</span><span class="nv">$csv_importer</span><span class="o">-&gt;</span><span class="na">import</span><span class="p">(</span><span class="nv">$csv_file</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// Provide success message to the user</span>
                    <span class="nv">$message</span> <span class="o">=</span> <span class="s1">&#39;Your file has been successfully imported!&#39;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nv">$message</span> <span class="o">=</span> <span class="s1">&#39;Your file did not import&#39;</span><span class="p">;</span>
                <span class="p">}</span>

            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="c1">// Provide a meaningful error message to the user</span>
                <span class="c1">// Perform any logging if necessary</span>
                <span class="nv">$message</span> <span class="o">=</span> <span class="s1">&#39;You must provide a CSV file for import.&#39;</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="nx">Redirect</span><span class="o">::</span><span class="na">back</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="nv">$message</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<blockquote>
<p>WARNING: We are making an assumption that the user is providing us with the correctly formatted file. THIS IS NOT A SAFE ASSUMPTION! You should never trust the user to provide correct content! You must ALWAYS validate users input including files. I will be adding another blog post with CSV validation in the near future, stay tuned!</p>
</blockquote>

<p><code>store()</code> - will be used for the POST route that the form will submit. We will perform some basic input validation to make sure that the file is present. We are constructing a CsvFileImporter and using the import method with our file.</p>

<h2>Importer Class</h2>

<p>Lets make <code>CsvFileImporter.php</code> inside <code>app/Acme/Importing</code>. This class is responsible for saving the file to a file system and importing it using the MySQL query I mentioned above.</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Acme\Importing</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">DB</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CsvFileImporter</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Import method used for saving file and importing it using a database query</span>
<span class="sd">     * </span>
<span class="sd">     * @param Symfony\Component\HttpFoundation\File\UploadedFile $csv_import</span>
<span class="sd">     * @return int number of lines imported</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">import</span><span class="p">(</span><span class="nv">$csv_import</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Save file to temp directory</span>
        <span class="nv">$moved_file</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">moveFile</span><span class="p">(</span><span class="nv">$csv_import</span><span class="p">);</span>

        <span class="c1">// Normalize line endings</span>
        <span class="nv">$normalized_file</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">normalize</span><span class="p">(</span><span class="nv">$moved_file</span><span class="p">);</span>

        <span class="c1">// Import contents of the file into database</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">importFileContents</span><span class="p">(</span><span class="nv">$normalized_file</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Move File to a temporary storage directory for processing</span>
<span class="sd">     * temporary directory must have 0755 permissions in order to be processed</span>
<span class="sd">     *</span>
<span class="sd">     * @param Symfony\Component\HttpFoundation\File\UploadedFile $csv_import</span>
<span class="sd">     * @return Symfony\Component\HttpFoundation\File $moved_file</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="k">function</span> <span class="nf">moveFile</span><span class="p">(</span><span class="nv">$csv_import</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Check if directory exists make sure it has correct permissions, if not make it</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">is_dir</span><span class="p">(</span><span class="nv">$destination_directory</span> <span class="o">=</span> <span class="nx">storage_path</span><span class="p">(</span><span class="s1">&#39;imports/tmp&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="nb">chmod</span><span class="p">(</span><span class="nv">$destination_directory</span><span class="p">,</span> <span class="mo">0755</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nb">mkdir</span><span class="p">(</span><span class="nv">$destination_directory</span><span class="p">,</span> <span class="mo">0755</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// Get file&#39;s original name</span>
        <span class="nv">$original_file_name</span> <span class="o">=</span> <span class="nv">$csv_import</span><span class="o">-&gt;</span><span class="na">getClientOriginalName</span><span class="p">();</span>

        <span class="c1">// Return moved file as File object</span>
        <span class="k">return</span> <span class="nv">$csv_import</span><span class="o">-&gt;</span><span class="na">move</span><span class="p">(</span><span class="nv">$destination_directory</span><span class="p">,</span> <span class="nv">$original_file_name</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Convert file line endings to uniform &quot;\r\n&quot; to solve for EOL issues</span>
<span class="sd">     * Files that are created on different platforms use different EOL characters</span>
<span class="sd">     * This method will convert all line endings to Unix uniform</span>
<span class="sd">     *</span>
<span class="sd">     * @param string $file_path</span>
<span class="sd">     * @return string $file_path</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">normalize</span><span class="p">(</span><span class="nv">$file_path</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//Load the file into a string</span>
        <span class="nv">$string</span> <span class="o">=</span> <span class="o">@</span><span class="nb">file_get_contents</span><span class="p">(</span><span class="nv">$file_path</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$string</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$file_path</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">//Convert all line-endings using regular expression</span>
        <span class="nv">$string</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">&#39;~\r\n?~&#39;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">);</span>

        <span class="nb">file_put_contents</span><span class="p">(</span><span class="nv">$file_path</span><span class="p">,</span> <span class="nv">$string</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$file_path</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Import CSV file into Database using LOAD DATA LOCAL INFILE function</span>
<span class="sd">     *</span>
<span class="sd">     * NOTE: PDO settings must have attribute PDO::MYSQL_ATTR_LOCAL_INFILE =&gt; true</span>
<span class="sd">     *</span>
<span class="sd">     * @param $file_path</span>
<span class="sd">     * @return mixed Will return number of lines imported by the query</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="k">function</span> <span class="nf">importFileContents</span><span class="p">(</span><span class="nv">$file_path</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$query</span> <span class="o">=</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s2">&quot;LOAD DATA LOCAL INFILE &#39;%s&#39; INTO TABLE file_import_contents </span>
<span class="s2">            LINES TERMINATED BY &#39;</span><span class="se">\\</span><span class="s2">n&#39;</span>
<span class="s2">            FIELDS TERMINATED BY &#39;,&#39; </span>
<span class="s2">            IGNORE 1 LINES (`content`)&quot;</span><span class="p">,</span> <span class="nb">addslashes</span><span class="p">(</span><span class="nv">$file_path</span><span class="p">));</span>

        <span class="k">return</span> <span class="nx">DB</span><span class="o">::</span><span class="na">connection</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getpdo</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>Now lets walk through each method and look at what each of them does.</p>

<p><code>import($csv_import)</code> method is the only public method of this class thats because we only want to worry about using the import method when importing. This method accepts 1 parameter. The parameter should be an instance of the <code>UploadedFile</code> class from the Laravel support library. This way we have conveniet access to methods like <code>getClientOriginalName()</code> and <code>move()</code>. This method will use the <code>moveFile()</code> <code>normalize()</code> and <code>importFileContents()</code> methods. It returns the result of <code>importFileContents()</code> method which will return the number of line imported by the SQL query.</p>

<p><code>moveFile($csv_import)</code> method is used to move our uploaded file to a temp directory and also verifies that we have appropriate file permissions. The directory and file permissions must be <code>0755</code> this is important because MySQL needs to be able to read from the directory and file when we execute the query. This method returns a new File object from the Laravel&#39;s support library</p>

<p><code>normalize($file_path)</code> method is a very useful workaround for file that are created on different platforms. This method will normalize all line endings to be <code>\n</code> format which is standard for Unix system. Learn more about line endings <a href="https://en.wikipedia.org/wiki/Newline">here</a>. This is also important for our query because we need to tell MySQL where the row of file stops. This method returns a newly written file object.</p>

<blockquote>
<p>NOTE: We are specifying the parameter to be a <code>$file_path</code>. This is because we only need a file path to use it inside of <code>file_get_contents()</code> method. Here is where some nice magic happens. <code>File</code> class extneds <code>SplFileInfo</code> class provided by PHP. This class has a <code>__toString()</code> method which will return a full path to the file. Neat!</p>
</blockquote>

<p><code>importFileContents()</code>method is where all of the import actually happens. This method builds up a SQL query and executes it using the DB class. The method returns the number of records processed by the query, if nothing was imported this method will return 0. </p>

<h2>Query breakdown</h2>

<p>Lets look closely at the query we are executing:
<code>LOAD DATA LOCAL INFILE</code> tells mySQL that it needs to stream the contents of the file into a specified table. The <code>LOCAL</code> flag tells MySQL server that the file resides on the same machine as the Database, this is usually the case unless you have a remote database server in whic case you can not use the <code>LOCAL</code> flag. Since we are using <code>sprintf()</code> function we are specifying the file path as a <code>%s</code> string format.</p>

<p><code>INTO TABLE</code> is fairly straight forward this is the table where you want the data to go to.</p>

<p><code>LINES TERMINATED BY &#39;\\n&#39;</code> will accept any character including <code>\n</code>,<code>\r</code>,<code>\r\n</code> line endings, or even <code>\t</code> tabs. This tell the query where the row will end and thus will being creating a new record.</p>

<p><code>FIELDS TERMINATED BY &#39;,&#39;</code> this parameter tells MySQL where each field should end. You may also specify the following optional parameter <code>ENCLOSED BY &#39;&#39;</code> which tell MySQL to only look for values which are enclosed in the specified character. This is helpful if you know that your data will be enclosed in &quot; or &#39; characters.</p>

<p><code>IGNORE 1 LINES</code> will tell MySQL to ignore the number of lines specified in the beginning of the file. This is helpful when your CSV file contains a header.</p>

<p>Additionally you can specify the column names which you would like to set by including    <code>SET (column_name, column_name2, etc)</code> </p>

<h2>Configuration notes:</h2>

<p>In order to use <code>LOAD DATA LOCAL INFILE</code> your PDO connection must have the
<code>PDO::MYSQL_ATTR_LOCAL_INFILE =&gt; true</code> parameter. It is set to false by default but its fairly simple to enable. </p>

<p>Open your <code>app/config/database.php</code> file. It should look something like this:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;?php

return array(

    /* other settings removed for brevity */
    &#39;connections&#39; =&gt; array(


        &#39;mysql&#39; =&gt; array(
            &#39;driver&#39;    =&gt; &#39;mysql&#39;,
            &#39;host&#39;      =&gt; &#39;localhost&#39;,
            &#39;database&#39;  =&gt; &#39;database&#39;,
            &#39;username&#39;  =&gt; &#39;root&#39;,
            &#39;password&#39;  =&gt; &#39;&#39;,
            &#39;charset&#39;   =&gt; &#39;utf8&#39;,
            &#39;collation&#39; =&gt; &#39;utf8_unicode_ci&#39;,
            &#39;prefix&#39;    =&gt; &#39;&#39;
        ),
        /* other connections removed for brevity */
    )
)
?&gt;
</code></pre></div>
<p>Now we need to add our connection options to the end of the <code>mysql</code> connection array. So your <code>database.php</code> file should end up looking like this.</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>

<span class="k">return</span> <span class="k">array</span><span class="p">(</span>

    <span class="cm">/* other settings removed for brevity */</span>
    <span class="s1">&#39;connections&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>


        <span class="s1">&#39;mysql&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;driver&#39;</span>    <span class="o">=&gt;</span> <span class="s1">&#39;mysql&#39;</span><span class="p">,</span>
            <span class="s1">&#39;host&#39;</span>      <span class="o">=&gt;</span> <span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
            <span class="s1">&#39;database&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;database&#39;</span><span class="p">,</span>
            <span class="s1">&#39;username&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
            <span class="s1">&#39;password&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;charset&#39;</span>   <span class="o">=&gt;</span> <span class="s1">&#39;utf8&#39;</span><span class="p">,</span>
            <span class="s1">&#39;collation&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;utf8_unicode_ci&#39;</span><span class="p">,</span>
            <span class="s1">&#39;prefix&#39;</span>    <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;options&#39;</span>   <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="nx">PDO</span><span class="o">::</span><span class="na">MYSQL_ATTR_LOCAL_INFILE</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">),</span>
        <span class="cm">/* other connections removed for brevity */</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>Thanks to <a href="http://fideloper.com/laravel-pdo-connection-options">fideloper.com</a> for discovering this nice trick.</p>

<blockquote>
<p>NOTE: From my experience this works best if your MySQL server version is ~ 5.6 earlier version of MySQL seem to experience problems when using the <code>LOCAL</code> parameter.</p>
</blockquote>

<p>Using this method large CSV files can be imported into MySQL really fast and thus are not required to be processed later. In a later post I will describe how we can validate the contents of the file before attempt to import it. I will also make a post about storing the CSV file and processing it at a later time using <code>php artisan</code> command and <code>crontab</code> job. If you enjoyed this post, share it, if you have questions, comments or concearns feel free to leave a comment below.</p>

<p>Next we will look at validating the CSV file structure before we run this import, head on over to <a href="/blog/import-large-csv-into-mysql-with-php-part-2-csv-file-validation/">Importing Large CSV files with PHP Part 2: Validating CSV file structure</a></p>


                </div>

                

                <hr />

                
                
                <div class="author-profile">
  <div class="about">
    <em>ABOUT THE AUTHOR</em><br/>
    <strong>Anton Domratchev</strong><br/>
    <p>Anton graduated from the University of Texas at San Antonio with a degree in Cyber Security. Anton started front end development with HTML, CSS and JavaScript in 2008, and has been developing in PHP since 2013. He is currently honing his Ruby on Rails skills while discovering the wonderful world of Software Architecture.</p>
  </div>
  <img src="/images/portrait-anton-domratchev.jpg" />
</div>

                

                <hr>
<p>
  Grok Interactive specializes in web and mobile development using Ruby, Swift, Elixir, Javascript, and various other technologies to solve problems for our clients. If we can assist you, please do not hesitate to <a href="/#contact">contact us</a> today.
</p>


                <div class="share-page">
  Share this on &rarr;
  <a href="https://twitter.com/intent/tweet?text=Importing Large CSV files with PHP Part 1: Import using one query&url=http://www.grok-interactive.com/blog/import-large-csv-into-mysql-with-php-part-1/&via=&related=" rel="nofollow" target="_blank" title="Share on Twitter">Twitter</a>
  <a href="https://facebook.com/sharer.php?u=http://www.grok-interactive.com/blog/import-large-csv-into-mysql-with-php-part-1/" rel="nofollow" target="_blank" title="Share on Facebook">Facebook</a>
  <a href="https://plus.google.com/share?url=http://www.grok-interactive.com/blog/import-large-csv-into-mysql-with-php-part-1/" rel="nofollow" target="_blank" title="Share on Google+">Google+</a>
</div>


                
<h3>Comments</h3>
<hr />
<!-- https://developers.facebook.com/docs/reference/plugins/comments/ -->
<div class='comments'>
  <div id="disqus_thread"></div>
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES * * */
      var disqus_shortname = 'grokinteractive';

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>



                <div itemprop="provider" itemscope itemtype="http://schema.org/Organization">
  <meta itemprop="name" content="Grok Interactive, LLC">
  <meta itemprop="logo" content="http://www.grok-interactive.com/images/grok-logo.svg">
  <div itemprop="address" itemscope itemtype="http://schema.org/PostalAddress">
    <meta itemprop="streetAddress" content="3517 Columbia Dr">
    <meta itemprop="postalCode" content="78108">
    <meta itemprop="addressLocality" content="San Antonio, Texas">
    <meta itemprop="email" content="jason@grok-interactive.com">
    <meta itemprop="telephone" content="1-210-702-3915">
  </div>
</div>


              </div>
            </div>


          </div>

          <div class="col c30">

            <div class="well">
  <h4><i class="icon fa fa-folder" title="Categories"></i> Categories</h4>
  <ul class="nav nav-list">
    

    <li><a href="/blog/category/general/">
      General
    </a></li>
    

    <li><a href="/blog/category/software_development/">
      Software development
    </a></li>
    

    <li><a href="/blog/category/training/">
      Training
    </a></li>
    

    <li><a href="/blog/category/testing/">
      Testing
    </a></li>
    

    <li><a href="/blog/category/environments/">
      Environments
    </a></li>
    

    <li><a href="/blog/category/business_development/">
      Business development
    </a></li>
    
  </ul>
</div>


            
<div class="well">
  <h4><i class="icon fa fa-users" title="Authors"></i> Authors</h4>
  <ul class="nav nav-list">
    
    
    <li><a href="/blog/author/jason-straughan">Jason Straughan</a></li>
    
    
    <li><a href="/blog/author/jason-ellis">Jason Ellis</a></li>
    
    
    <li><a href="/blog/author/josh-freeman">Josh Freeman</a></li>
    
    
    <li><a href="/blog/author/chris-hardee">Chris Hardee</a></li>
    
    
    <li><a href="/blog/author/john-guest">John Guest</a></li>
    
    
    <li><a href="/blog/author/anton-domratchev">Anton Domratchev</a></li>
    
    
    <li><a href="/blog/author/joseph-villafranca">Joseph Villafranca</a></li>
    
    
    <li><a href="/blog/author/christopher-moeller">Christopher Moeller</a></li>
    
  </ul>
</div>



            <div class="well">
  <h4><i class="icon fa fa-tags" title="Categories"></i> Tags</h4>

  <ul class="nav nav-list">
    
    <li><a href="/blog/tag/grok">Grok</a></li>
    
    <li><a href="/blog/tag/industry">Industry</a></li>
    
    <li><a href="/blog/tag/codeup">Codeup</a></li>
    
    <li><a href="/blog/tag/security">Security</a></li>
    
    <li><a href="/blog/tag/php">Php</a></li>
    
    <li><a href="/blog/tag/phpunit">Phpunit</a></li>
    
    <li><a href="/blog/tag/emacs">Emacs</a></li>
    
    <li><a href="/blog/tag/expression_engine">Expression engine</a></li>
    
    <li><a href="/blog/tag/javascript">Javascript</a></li>
    
    <li><a href="/blog/tag/dom">Dom</a></li>
    
    <li><a href="/blog/tag/jquery">Jquery</a></li>
    
    <li><a href="/blog/tag/git">Git</a></li>
    
    <li><a href="/blog/tag/githooks">Githooks</a></li>
    
    <li><a href="/blog/tag/source_control">Source control</a></li>
    
    <li><a href="/blog/tag/css">Css</a></li>
    
    <li><a href="/blog/tag/rails">Rails</a></li>
    
    <li><a href="/blog/tag/ubuntu">Ubuntu</a></li>
    
    <li><a href="/blog/tag/linux">Linux</a></li>
    
    <li><a href="/blog/tag/developers">Developers</a></li>
    
    <li><a href="/blog/tag/node.js">Node.js</a></li>
    
    <li><a href="/blog/tag/mongodb">Mongodb</a></li>
    
    <li><a href="/blog/tag/javascript">Javascript</a></li>
    
    <li><a href="/blog/tag/socket.io">Socket.io</a></li>
    
    <li><a href="/blog/tag/express.js">Express.js</a></li>
    
    <li><a href="/blog/tag/email">Email</a></li>
    
    <li><a href="/blog/tag/outlook">Outlook</a></li>
    
    <li><a href="/blog/tag/cross_mail_client">Cross mail client</a></li>
    
    <li><a href="/blog/tag/compatibility">Compatibility</a></li>
    
    <li><a href="/blog/tag/mvc">Mvc</a></li>
    
    <li><a href="/blog/tag/object_oriented_programming">Object oriented programming</a></li>
    
    <li><a href="/blog/tag/domain_driven_design">Domain driven design</a></li>
    
    <li><a href="/blog/tag/value_objects">Value objects</a></li>
    
    <li><a href="/blog/tag/types">Types</a></li>
    
    <li><a href="/blog/tag/csv">Csv</a></li>
    
    <li><a href="/blog/tag/mysql">Mysql</a></li>
    
    <li><a href="/blog/tag/laravel">Laravel</a></li>
    
    <li><a href="/blog/tag/ruby">Ruby</a></li>
    
    <li><a href="/blog/tag/functional_programming">Functional programming</a></li>
    
    <li><a href="/blog/tag/schema.org">Schema.org</a></li>
    
  </ul>
</div>


          </div>
        </div>

      </div>
    </div>

  </div>
</div>




    </div>
  </div>

  <footer>
  <div class="container">
    <div class="pull-left">
      <p>&copy; 2013&ndash;2015 Grok Interactive, LLC</p>
    </div>
  </div>
</footer>


  <script type='text/javascript' src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js'></script>

  <script src='/assets/global-5b2d0cc47ae047645ffc10228e2867fb.js' type='text/javascript'></script>

  <script src="//static.getclicky.com/js" type="text/javascript"></script>
  <script type="text/javascript">try{ clicky.init(100585693); }catch(e){}</script>
  <noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/100585693ns.gif" /></p></noscript>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-43998305-2', 'grok-interactive.com');
    ga('send', 'pageview');
  </script>
</body>
</html>
